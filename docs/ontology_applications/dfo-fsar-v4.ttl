@prefix dfo:  <https://w3id.org/dfo/salmon#> .
@prefix fsar: <https://w3id.org/dfo/salmon/fsar#> .
@prefix owl:  <http://www.w3.org/2002/07/owl#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .

#################################################################
# Ontology header
#################################################################

fsar: a owl:Ontology ;
  dcterms:title "DFO Salmon – FSAR Tracer Module (WSP rapid-status support)"@en ;
  dcterms:description "OWL2 DL module providing a minimal, reusable mapping from bottom-up assessment triggers to top-down requirement classes for UI/queries. Includes WSP rapid-status assessment support with metric benchmarks, algorithm thresholds, and confidence categories. It avoids tracking decision instances and does not duplicate core dfo: classes/properties. It is designed to work with SPSR metadata as-is, with a short TODO list for optional future fields."@en ;
  dcterms:creator "Thunk Solutions – FSAR Tracer"@en ;
  dcterms:license <https://creativecommons.org/publicdomain/zero/1.0/> ;
  owl:versionInfo "0.5.0" .

#################################################################
# Core scaffolding (no instances)
#################################################################

fsar:TriggerCondition a owl:Class ;
  rdfs:label "Trigger condition"@en ;
  rdfs:comment "A general condition observed from assessment metadata (e.g., WSP zone=Red) that activates one or more requirements."@en .

fsar:Requirement a owl:Class ;
  rdfs:label "Requirement"@en ;
  rdfs:comment "A high-level obligation/check that applies when certain triggers hold (e.g., rebuilding plan when below LRP)."@en .

fsar:PolicyFramework a owl:Class ;
  rdfs:label "Policy framework"@en ;
  rdfs:comment "A legal/policy framework node (e.g., WSP, PA, Fisheries Act FSP). Used for lightweight citation only."@en .

#################################################################
# Minimal trigger set (derived from SPSR fields and common FSAR cues)
#################################################################

# NOTE: The app determines which trigger classes apply using SPSR fields:
# - CU rapid status: CUStatus.WSP_RAPID_STATUS ∈ {Green, Amber, Red}
# - (TODO) Mixed-stock flag: add a boolean field if needed (or infer from context)
# - (TODO) GSI usage: add boolean or infer from GRD link
# - (Optional) Confidence present: CUStatus.WSP_RAPID_STATUS_CONFIDENCE not empty

fsar:BelowLRPTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Below LRP (WSP Red) trigger"@en ;
  rdfs:comment "Use when WSP rapid status is Red (or CU at/below LRP). Minimal logic: CUStatus.WSP_RAPID_STATUS='Red'."@en .

fsar:BetweenLRPUSRTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Cautious zone (between LRP and USR) trigger"@en ;
  rdfs:comment "Use when WSP rapid status is Amber. Minimal logic: CUStatus.WSP_RAPID_STATUS='Amber'."@en .

fsar:UncertaintyMissingConfidenceTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Missing confidence info trigger"@en ;
  rdfs:comment "Use when confidence field is blank or not provided. Minimal logic: CUStatus.WSP_RAPID_STATUS_CONFIDENCE is null/empty."@en .

# The following triggers are optional (require small SPSR metadata extensions)
fsar:MixedStockNoGSITrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Mixed-stock without GSI trigger (TODO field)"@en ;
  rdfs:comment "Use when a fishery is mixed-stock but GSI apportionment was not used. Requires minimal flags (mixedStock=true, gsiUsed=false)."@en .

fsar:CUProxiedTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "CU proxied/excluded trigger (TODO field)"@en ;
  rdfs:comment "Use when one or more CUs are proxied/excluded from assessment. Requires a simple boolean or enum at intake."@en .

#################################################################
# Lightweight requirement classes (no workflow/sign-off baked in)
#################################################################

fsar:RebuildingPlanRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "Rebuilding plan overview required"@en ;
  rdfs:comment "Show that the stock/SMU is subject to rebuilding provisions when at/below LRP (e.g., link or note). No workflow implied."@en .

fsar:CautiousHarvestReviewRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "Cautious-zone harvest measures overview"@en ;
  rdfs:comment "Provide a brief overview of precautionary measures in Amber (e.g., reductions, HCR tuning, time/area/gear adjustments)."@en .

fsar:UncertaintyDisclosureRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "Uncertainty disclosure"@en ;
  rdfs:comment "Briefly indicate uncertainty/precision or note that it is currently unavailable."@en .

fsar:MixedStockJustificationRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "Mixed-stock apportionment overview (TODO field)"@en ;
  rdfs:comment "If mixed-stock and no GSI, note how impacts are controlled/monitored or why GSI not used. Minimal text, no workflow."@en .

fsar:CUAccountingNoteRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "CU accounting note (TODO field)"@en ;
  rdfs:comment "If CUs are proxied/excluded, provide a brief rationale. Minimal text, no reviewer features."@en .

#################################################################
# Policy frameworks (for lightweight citation, not logic)
#################################################################

fsar:FisheriesActFSP a fsar:PolicyFramework ;
  rdfs:label "Fisheries Act – Fish Stocks Provisions (FSP)"@en .

fsar:WildSalmonPolicy a fsar:PolicyFramework ;
  rdfs:label "Canada's Policy for Conservation of Wild Pacific Salmon (WSP)"@en .

fsar:PrecautionaryApproach a fsar:PolicyFramework ;
  rdfs:label "A Fishery Decision‑making Framework Incorporating the Precautionary Approach (PA)"@en .

#################################################################
# Generic mapping: triggers → requirements and requirements → frameworks
#################################################################

fsar:triggersRequirement a owl:ObjectProperty ;
  rdfs:domain fsar:TriggerCondition ;
  rdfs:range  fsar:Requirement ;
  rdfs:label "triggers requirement"@en .

fsar:requiredBy a owl:ObjectProperty ;
  rdfs:domain fsar:Requirement ;
  rdfs:range  fsar:PolicyFramework ;
  rdfs:label "required by"@en .

# Below LRP => Rebuilding plan (FSP); also ties to WSP/PA high-level language
fsar:BelowLRPTrigger fsar:triggersRequirement fsar:RebuildingPlanRequirement .
fsar:RebuildingPlanRequirement fsar:requiredBy fsar:FisheriesActFSP .
fsar:RebuildingPlanRequirement fsar:requiredBy fsar:WildSalmonPolicy .
fsar:RebuildingPlanRequirement fsar:requiredBy fsar:PrecautionaryApproach .

# Amber zone => Cautious measures (PA/WSP)
fsar:BetweenLRPUSRTrigger fsar:triggersRequirement fsar:CautiousHarvestReviewRequirement .
fsar:CautiousHarvestReviewRequirement fsar:requiredBy fsar:WildSalmonPolicy .
fsar:CautiousHarvestReviewRequirement fsar:requiredBy fsar:PrecautionaryApproach .

# Missing confidence info => Uncertainty disclosure
fsar:UncertaintyMissingConfidenceTrigger fsar:triggersRequirement fsar:UncertaintyDisclosureRequirement .
fsar:UncertaintyDisclosureRequirement fsar:requiredBy fsar:PrecautionaryApproach .

# Optional TODO triggers
fsar:MixedStockNoGSITrigger fsar:triggersRequirement fsar:MixedStockJustificationRequirement .
fsar:CUProxiedTrigger     fsar:triggersRequirement fsar:CUAccountingNoteRequirement .

#################################################################
# WSP Rapid-Status Support
#################################################################

# WSP Metric classes
fsar:WSPMetric a owl:Class ;
  rdfs:label "WSP metric"@en ;
  rdfs:comment "One of four standard WSP metrics used in rapid status assessments: absolute abundance, relative abundance, long-term trend, or percent change."@en .

fsar:MetricBenchmark a owl:Class ;
  rdfs:label "Metric benchmark"@en ;
  rdfs:comment "A WSP metric benchmark value used to determine status zones. Benchmarks are established through expert processes and may differ from algorithm thresholds used in Learning Tree 3."@en .

fsar:AlgorithmThreshold a owl:Class ;
  rdfs:label "Algorithm threshold"@en ;
  rdfs:comment "A threshold value used by the Learning Tree 3 rapid status algorithm. Thresholds may differ from metric benchmarks by design, incorporating buffers and precautionary adjustments."@en .

fsar:WSPRapidStatus a owl:Class , skos:Concept ;
  rdfs:label "WSP rapid status"@en ;
  rdfs:comment "A rapid status category assigned by the Learning Tree 3 algorithm: Red (poor), Amber (intermediate), or Green (good)."@en .

fsar:ConfidenceCategory a owl:Class , skos:Concept ;
  rdfs:label "Confidence category"@en ;
  rdfs:comment "Confidence level in a WSP rapid status assessment: High, Medium, or Low. Confidence depends on metric availability and data quality."@en .

fsar:Condition a owl:Class ;
  rdfs:label "Condition"@en ;
  rdfs:comment "A trigger condition pattern that may relate to existing TriggerCondition classes. Used to link metric positions to decision requirements."@en .

fsar:DecisionRequirement a owl:Class ;
  rdfs:label "Decision requirement"@en ;
  rdfs:comment "A general obligation pattern describing decision requirements triggered by status/metric positions. Note: v3 has Requirement class for specific types."@en .

# Object properties for WSP rapid-status
fsar:assessesMetric a owl:ObjectProperty ;
  rdfs:domain dfo:StockAssessment ;
  rdfs:range fsar:WSPMetric ;
  rdfs:label "assesses metric"@en ;
  rdfs:comment "Links a stock assessment to a WSP metric it assesses."@en .

fsar:hasBenchmark a owl:ObjectProperty ;
  rdfs:domain fsar:WSPMetric ;
  rdfs:range fsar:MetricBenchmark ;
  rdfs:label "has benchmark"@en ;
  rdfs:comment "Links a WSP metric to its benchmark values."@en .

fsar:hasAlgorithmThreshold a owl:ObjectProperty ;
  rdfs:domain fsar:WSPMetric ;
  rdfs:range fsar:AlgorithmThreshold ;
  rdfs:label "has algorithm threshold"@en ;
  rdfs:comment "Links a WSP metric to its Learning Tree 3 algorithm threshold values."@en .

fsar:producesRapidStatus a owl:ObjectProperty ;
  rdfs:domain dfo:StockAssessment ;
  rdfs:range fsar:WSPRapidStatus ;
  rdfs:label "produces rapid status"@en ;
  rdfs:comment "Links a stock assessment to the WSP rapid status it produces."@en .

fsar:hasConfidence a owl:ObjectProperty ;
  rdfs:domain dfo:StockAssessment ;
  rdfs:range fsar:ConfidenceCategory ;
  rdfs:label "has confidence"@en ;
  rdfs:comment "Links a stock assessment to its confidence category."@en .

fsar:triggeredBy a owl:ObjectProperty ;
  rdfs:domain fsar:DecisionRequirement ;
  rdfs:range fsar:Condition ;
  rdfs:label "triggered by"@en ;
  rdfs:comment "Links a decision requirement to the condition that triggers it."@en .

fsar:mandatedBy a owl:ObjectProperty ;
  rdfs:domain fsar:DecisionRequirement ;
  rdfs:range dcterms:BibliographicResource ;
  rdfs:label "mandated by"@en ;
  rdfs:comment "Links a decision requirement to the policy framework or document that mandates it."@en .

# Datatype properties
fsar:numericValue a owl:DatatypeProperty ;
  rdfs:domain [ owl:unionOf (fsar:MetricBenchmark fsar:AlgorithmThreshold) ] ;
  rdfs:range xsd:decimal ;
  rdfs:label "numeric value"@en ;
  rdfs:comment "The numeric value of a benchmark or algorithm threshold."@en .

fsar:units a owl:DatatypeProperty ;
  rdfs:domain [ owl:unionOf (fsar:MetricBenchmark fsar:AlgorithmThreshold) ] ;
  rdfs:range xsd:string ;
  rdfs:label "units"@en ;
  rdfs:comment "The units of measurement for a benchmark or algorithm threshold."@en .

fsar:note a owl:DatatypeProperty ;
  rdfs:domain owl:Thing ;
  rdfs:range xsd:string ;
  rdfs:label "note"@en ;
  rdfs:comment "A general annotation note."@en .

fsar:rationaleNote a owl:DatatypeProperty ;
  rdfs:domain [ owl:unionOf (dfo:StockAssessment fsar:WSPMetric) ] ;
  rdfs:range xsd:string ;
  rdfs:label "rationale note"@en ;
  rdfs:comment "A note explaining the rationale for threshold differences or assessment decisions."@en .

fsar:hatcheryTreatmentNote a owl:DatatypeProperty ;
  rdfs:domain dfo:StockAssessment ;
  rdfs:range xsd:string ;
  rdfs:label "hatchery treatment note"@en ;
  rdfs:comment "A lightweight annotation describing how hatchery influence was handled in the assessment."@en .

# WSP Metric individuals
fsar:absoluteAbundance a fsar:WSPMetric ;
  rdfs:label "Absolute abundance"@en ;
  rdfs:comment "WSP metric comparing generational average spawner abundance to COSEWIC criterion D1 thresholds (1,000 lower, 10,000 upper)."@en .

fsar:relativeAbundance a fsar:WSPMetric ;
  rdfs:label "Relative abundance"@en ;
  rdfs:comment "WSP metric comparing generational average spawner abundance to CU-specific benchmarks (Sgen lower, 80% SMSY upper typically)."@en .

fsar:longTermTrend a fsar:WSPMetric ;
  rdfs:label "Long-term trend"@en ;
  rdfs:comment "WSP metric comparing current generational average to long-term average spawner abundance (benchmarks: 50% lower, 75% upper)."@en .

fsar:percentChange a fsar:WSPMetric ;
  rdfs:label "Percent change"@en ;
  rdfs:comment "WSP metric quantifying linear change in spawner abundance over the most recent three generations (benchmarks: -25% lower, -15% upper)."@en .

# Status category individuals (using SKOS)
fsar:Red a fsar:WSPRapidStatus ;
  skos:prefLabel "Red"@en ;
  rdfs:label "Red status"@en ;
  rdfs:comment "WSP rapid status indicating poor status (at or below LRP)."@en .

fsar:Amber a fsar:WSPRapidStatus ;
  skos:prefLabel "Amber"@en ;
  rdfs:label "Amber status"@en ;
  rdfs:comment "WSP rapid status indicating intermediate status (between LRP and USR, in Cautious zone)."@en .

fsar:Green a fsar:WSPRapidStatus ;
  skos:prefLabel "Green"@en ;
  rdfs:label "Green status"@en ;
  rdfs:comment "WSP rapid status indicating good status (at or above USR, in Healthy zone)."@en .

# Confidence category individuals (using SKOS)
fsar:High a fsar:ConfidenceCategory ;
  skos:prefLabel "High"@en ;
  rdfs:label "High confidence"@en ;
  rdfs:comment "High confidence in rapid status assessment, typically when absolute or relative abundance metrics are available."@en .

fsar:Medium a fsar:ConfidenceCategory ;
  skos:prefLabel "Medium"@en ;
  rdfs:label "Medium confidence"@en ;
  rdfs:comment "Medium confidence in rapid status assessment, typically when status is based on trend metrics with some abundance information."@en .

fsar:Low a fsar:ConfidenceCategory ;
  skos:prefLabel "Low"@en ;
  rdfs:label "Low confidence"@en ;
  rdfs:comment "Low confidence in rapid status assessment, typically when status is based on trend metrics alone without abundance benchmarks."@en .

# Example benchmark instances (illustrative)
fsar:absAbund_lowerBenchmark a fsar:MetricBenchmark ;
  rdfs:label "Absolute abundance lower benchmark"@en ;
  fsar:numericValue 1000.0 ;
  fsar:units "spawners" ;
  rdfs:comment "COSEWIC criterion D1 threshold for small population size."@en .

fsar:absAbund_upperBenchmark a fsar:MetricBenchmark ;
  rdfs:label "Absolute abundance upper benchmark"@en ;
  fsar:numericValue 10000.0 ;
  fsar:units "spawners" ;
  rdfs:comment "Upper threshold for increased protection from environmental variation."@en .

fsar:trend_lowerBenchmark a fsar:MetricBenchmark ;
  rdfs:label "Long-term trend lower benchmark"@en ;
  fsar:numericValue 50.0 ;
  fsar:units "percent" ;
  rdfs:comment "Lower benchmark: 50% of long-term average."@en .

fsar:trend_upperBenchmark a fsar:MetricBenchmark ;
  rdfs:label "Long-term trend upper benchmark"@en ;
  fsar:numericValue 75.0 ;
  fsar:units "percent" ;
  rdfs:comment "Upper benchmark: 75% of long-term average."@en .

fsar:pctChange_lowerBenchmark a fsar:MetricBenchmark ;
  rdfs:label "Percent change lower benchmark"@en ;
  fsar:numericValue -25.0 ;
  fsar:units "percent" ;
  rdfs:comment "Lower benchmark: -25% change over three generations."@en .

fsar:pctChange_upperBenchmark a fsar:MetricBenchmark ;
  rdfs:label "Percent change upper benchmark"@en ;
  fsar:numericValue -15.0 ;
  fsar:units "percent" ;
  rdfs:comment "Upper benchmark: -15% change over three generations."@en .

# Link metrics to benchmarks
fsar:absoluteAbundance fsar:hasBenchmark fsar:absAbund_lowerBenchmark ;
                        fsar:hasBenchmark fsar:absAbund_upperBenchmark .

fsar:longTermTrend fsar:hasBenchmark fsar:trend_lowerBenchmark ;
                   fsar:hasBenchmark fsar:trend_upperBenchmark .

fsar:percentChange fsar:hasBenchmark fsar:pctChange_lowerBenchmark ;
                   fsar:hasBenchmark fsar:pctChange_upperBenchmark .

# Example algorithm threshold instances (showing differences)
fsar:absAbund_LT3_lower a fsar:AlgorithmThreshold ;
  rdfs:label "Absolute abundance Learning Tree 3 lower threshold"@en ;
  fsar:numericValue 1500.0 ;
  fsar:units "spawners" ;
  fsar:note "COSEWIC threshold (1,000) plus 500 buffer to account for uncertainty and how experts treated individual years in generational averages."@en .

fsar:absAbund_LT3_upper a fsar:AlgorithmThreshold ;
  rdfs:label "Absolute abundance Learning Tree 3 upper threshold"@en ;
  fsar:numericValue 10000.0 ;
  fsar:units "spawners" ;
  rdfs:comment "Same as benchmark upper threshold."@en .

fsar:longTermTrend_LT3_lower a fsar:AlgorithmThreshold ;
  rdfs:label "Long-term trend Learning Tree 3 lower threshold"@en ;
  fsar:numericValue 79.0 ;
  fsar:units "percent" ;
  fsar:note "Emerged from CART analyses, differs from benchmark (50%) as applied in combination with other metrics."@en .

fsar:longTermTrend_LT3_upper a fsar:AlgorithmThreshold ;
  rdfs:label "Long-term trend Learning Tree 3 upper threshold"@en ;
  fsar:numericValue 233.0 ;
  fsar:units "percent" ;
  fsar:note "Emerged from CART analyses, differs from benchmark (75%). Only applied conditionally with percent change metric."@en .

fsar:percentChange_LT3_lower a fsar:AlgorithmThreshold ;
  rdfs:label "Percent change Learning Tree 3 lower threshold"@en ;
  fsar:numericValue -70.0 ;
  fsar:units "percent" ;
  fsar:note "Emerged from CART analyses, differs from benchmark (-25%). Only applied conditionally when long-term trend >= 79% and absolute abundance >= 10,000."@en .

# Link metrics to algorithm thresholds
fsar:absoluteAbundance fsar:hasAlgorithmThreshold fsar:absAbund_LT3_lower ;
                        fsar:hasAlgorithmThreshold fsar:absAbund_LT3_upper .

fsar:longTermTrend fsar:hasAlgorithmThreshold fsar:longTermTrend_LT3_lower ;
                   fsar:hasAlgorithmThreshold fsar:longTermTrend_LT3_upper .

fsar:percentChange fsar:hasAlgorithmThreshold fsar:percentChange_LT3_lower .

# Condition pattern instances
fsar:BelowAbsAbund_LT3Lower a fsar:Condition ;
  rdfs:label "Below absolute abundance Learning Tree 3 lower threshold"@en ;
  fsar:note "Triggered when generational average spawner abundance falls below 1,500 (algorithm threshold with buffer)."@en .

fsar:BelowLRP a fsar:Condition ;
  rdfs:label "Below LRP"@en ;
  fsar:note "Triggered when CU rapid status is Red, indicating status at or below Limit Reference Point."@en .

# Decision requirement pattern instances
fsar:RebuildingPlanRequirementPattern a fsar:DecisionRequirement ;
  rdfs:label "Rebuilding plan requirement pattern"@en ;
  fsar:triggeredBy fsar:BelowLRP ;
  fsar:mandatedBy <https://laws-lois.justice.gc.ca/eng/acts/F-14/> .

fsar:ApplyHarvestRulesRequirement a fsar:DecisionRequirement ;
  rdfs:label "Apply harvest rules requirement"@en ;
  fsar:triggeredBy fsar:BelowAbsAbund_LT3Lower ;
  fsar:mandatedBy <https://www.dfo-mpo.gc.ca/fisheries-peches/management-gestion/precautionary-approach-precautionneuse/index-eng.html> .

