@prefix dfo:  <https://w3id.org/dfo/salmon#> .
@prefix fsar: <https://w3id.org/dfo/salmon/fsar#> .
@prefix owl:  <http://www.w3.org/2002/07/owl#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix prov: <http://www.w3.org/ns/prov#> .

#################################################################
# Ontology header
#################################################################

fsar: a owl:Ontology ;
  dcterms:title "DFO Salmon – FSAR Tracer Module"@en ;
  dcterms:description "OWL2 DL‑compliant module that encodes generic policy triggers and requirement classes for FSAR workflows. Designed to integrate with the core DFO Salmon Ontology (dfo:), reusing core classes (e.g., dfo:StatusAssessment, dfo:ReferencePoint) and adding FSAR‑specific concept schemes and properties. Avoids ABox decision tracking; focuses on reusable rule scaffolding for UI logic & SPARQL queries."@en ;
  dcterms:creator "Thunk Solutions – FSAR Tracer"@en ;
  dcterms:license <https://creativecommons.org/publicdomain/zero/1.0/> ;
  owl:versionInfo "0.3.0" .

#################################################################
# High‑level modelling note
#################################################################
# This module does NOT define assessment/decision instances.
# Instead it defines:
#  1) TriggerCondition classes (bottom‑up),
#  2) Requirement classes (top‑down),
#  3) A mapping from triggers → requirements (class‑to‑class links),
#  4) Controlled concept schemes for sectors, decision types, status zones, downgrade criteria.
# Apps compute applicable requirements by:
#   - inspecting an assessment’s data (status zone, below LRP, mixed‑stock, CU proxies, uncertainty flags),
#   - matching those facts to TriggerCondition classes,
#   - joining TriggerCondition → Requirement via fsar:triggersRequirement.
# This keeps the ontology in OWL2 DL and avoids SWRL; reasoning is simple subsumption + SPARQL.

#################################################################
# Core classes
#################################################################

fsar:TriggerCondition a owl:Class ;
  rdfs:label "Trigger condition"@en ;
  rdfs:comment "A general condition observed in the assessment (e.g., below LRP, mixed‑stock without GSI, CU proxied) that activates one or more policy/quality requirements."@en .

fsar:Requirement a owl:Class ;
  rdfs:subClassOf dfo:Requirement ;
  rdfs:label "Requirement"@en ;
  rdfs:comment "A top‑down obligation or check (policy, legal, quality, documentation) that must be demonstrated when certain triggers apply."@en .

fsar:PolicyFramework a owl:Class ;
  rdfs:subClassOf dfo:PolicyFramework ;
  rdfs:label "Policy framework"@en ;
  rdfs:comment "A legal or policy framework such as the Fisheries Act Fish Stocks Provisions (FSP), Wild Salmon Policy (WSP), or the Precautionary Approach (PA)."@en .

#################################################################
# Concept schemes (controlled vocabularies)
#################################################################

# Sectors (from Decision Inventory)
fsar:Sectors a skos:ConceptScheme ;
  dcterms:title "DFO Sectors"@en .

fsar:FM a skos:Concept ; skos:inScheme fsar:Sectors ; skos:prefLabel "Fisheries Management (FM)"@en .
fsar:SEP a skos:Concept ; skos:inScheme fsar:Sectors ; skos:prefLabel "Salmon Enhancement Program (SEP)"@en .
fsar:FFH a skos:Concept ; skos:inScheme fsar:Sectors ; skos:prefLabel "Freshwater Fish Habitat (FFH)"@en .
fsar:MSP a skos:Concept ; skos:inScheme fsar:Sectors ; skos:prefLabel "Marine Spatial Planning (MSP)"@en .
fsar:SARA a skos:Concept ; skos:inScheme fsar:Sectors ; skos:prefLabel "Species at Risk Act (SARA)"@en .
fsar:AQUACULTURE a skos:Concept ; skos:inScheme fsar:Sectors ; skos:prefLabel "Aquaculture"@en .

# Decision types (subset aligned with Decision Inventory)
fsar:DecisionTypes a skos:ConceptScheme ;
  dcterms:title "Decision Types (subset)"@en .

fsar:TAC a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Total Allowable Catch (TAC)"@en .
fsar:Allocation a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Allocation (target & non‑target impacts)"@en .
fsar:EcosystemMeasures a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Ecosystem measures"@en .
fsar:AccessLicensing a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Access & licensing"@en .
fsar:TimesAreas a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Times & areas"@en .
fsar:GearEffort a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Gear/Effort limits"@en .
fsar:MonitoringReporting a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Monitoring & reporting"@en .
fsar:RebuildingPlan a skos:Concept ; skos:inScheme fsar:DecisionTypes ; skos:prefLabel "Rebuilding plan"@en .

# Status zones (WSP style)
fsar:WSPZones a skos:ConceptScheme ;
  dcterms:title "Wild Salmon Policy Zones"@en .

fsar:WSP_Red   a skos:Concept ; skos:inScheme fsar:WSPZones ; skos:prefLabel "Red (Below LRP)"@en .
fsar:WSP_Amber a skos:Concept ; skos:inScheme fsar:WSPZones ; skos:prefLabel "Amber (Between LRP and USR)"@en .
fsar:WSP_Green a skos:Concept ; skos:inScheme fsar:WSPZones ; skos:prefLabel "Green (Above USR)"@en .

# Downgrade criteria (controlled list, examples)
fsar:DowngradeCriteria a skos:ConceptScheme ;
  dcterms:title "Data/Estimate Downgrade Criteria"@en .

fsar:LowSurveyQuality a skos:Concept ; skos:inScheme fsar:DowngradeCriteria ; skos:prefLabel "Low survey quality"@en .
fsar:ProxyCU a skos:Concept ; skos:inScheme fsar:DowngradeCriteria ; skos:prefLabel "CU proxied"@en .
fsar:NoCI a skos:Concept ; skos:inScheme fsar:DowngradeCriteria ; skos:prefLabel "Missing confidence interval"@en .

#################################################################
# Trigger conditions (bottom‑up)
#################################################################

fsar:BelowLRPTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Below LRP trigger"@en ;
  rdfs:comment "Triggered when the assessed SMU/CU status indicates being at or below the Lower Reference Point (LRP) (WSP Red zone)."@en .

fsar:BetweenLRPUSRTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Between LRP and USR trigger"@en ;
  rdfs:comment "Triggered when status is in the cautious zone (WSP Amber)."@en .

fsar:AboveUSRTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Above USR trigger"@en ;
  rdfs:comment "Triggered when status is in the healthy zone (WSP Green)."@en .

fsar:MixedStockNoGSITrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Mixed‑stock without GSI trigger"@en ;
  rdfs:comment "Triggered when mixed‑stock fisheries are present but GSI apportionment was not used or not justified."@en .

fsar:CUProxiedTrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "CU proxied trigger"@en ;
  rdfs:comment "Triggered when one or more CUs lack direct data and are proxied or excluded; requires justification and reviewer sign‑off."@en .

fsar:UncertaintyMissingCITrigger a owl:Class ;
  rdfs:subClassOf fsar:TriggerCondition ;
  rdfs:label "Missing CI trigger"@en ;
  rdfs:comment "Triggered when key estimates lack uncertainty bounds or documented rationale."@en .

#################################################################
# Requirements (top‑down)
#################################################################

fsar:RebuildingPlanRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "Rebuilding plan requirement"@en ;
  rdfs:comment "When a prescribed major stock is at or below the LRP, a rebuilding plan must be developed and published within specified timelines under the Fish Stocks Provisions of the Fisheries Act."@en ;
  fsar:appliesToSector fsar:FM ;
  fsar:relatesToDecisionType fsar:RebuildingPlan .

fsar:PrecautionaryClosureReview a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "Precautionary closure/limit review"@en ;
  rdfs:comment "In the cautious zone (between LRP and USR), review HCR settings, exploitation ceilings, time/area/gear measures to avoid entering the critical zone."@en ;
  fsar:appliesToSector fsar:FM ;
  fsar:relatesToDecisionType fsar:TimesAreas, fsar:GearEffort, fsar:TAC .

fsar:GSIJustificationRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "GSI justification requirement"@en ;
  rdfs:comment "For mixed‑stock fisheries, document GSI usage, sample sizes, and assignment uncertainty, or provide a rationale if not used."@en ;
  fsar:appliesToSector fsar:FM ;
  fsar:relatesToDecisionType fsar:MonitoringReporting .

fsar:CUAccountingJustificationRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "CU accounting justification requirement"@en ;
  rdfs:comment "For CU inclusion decisions (proxied/excluded), provide justification and reviewer sign‑off."@en ;
  fsar:appliesToSector fsar:FM ;
  fsar:relatesToDecisionType fsar:MonitoringReporting .

fsar:UncertaintyDisclosureRequirement a owl:Class ;
  rdfs:subClassOf fsar:Requirement ;
  rdfs:label "Uncertainty disclosure requirement"@en ;
  rdfs:comment "Disclose confidence intervals for key estimates or provide documented rationale; include downgrade criteria where applicable."@en ;
  fsar:appliesToSector fsar:FM ;
  fsar:relatesToDecisionType fsar:MonitoringReporting .

#################################################################
# Policy frameworks (reference nodes)
#################################################################

fsar:FisheriesActFSP a fsar:PolicyFramework ;
  rdfs:label "Fisheries Act – Fish Stocks Provisions (FSP)"@en .

fsar:WildSalmonPolicy a fsar:PolicyFramework ;
  rdfs:label "Canada’s Policy for Conservation of Wild Pacific Salmon (WSP)"@en .

fsar:PrecautionaryApproach a fsar:PolicyFramework ;
  rdfs:label "A Fishery Decision‑making Framework Incorporating the Precautionary Approach (PA)"@en .

#################################################################
# Generic mapping: triggers → requirements and requirements → frameworks
#################################################################

# Bottom‑up trigger to top‑down requirement
fsar:triggersRequirement a owl:ObjectProperty ;
  rdfs:domain fsar:TriggerCondition ;
  rdfs:range  fsar:Requirement ;
  rdfs:label "triggers requirement"@en .

# Requirement to governing framework
fsar:requiredBy a owl:ObjectProperty ;
  rdfs:domain fsar:Requirement ;
  rdfs:range  fsar:PolicyFramework ;
  rdfs:label "required by"@en .

# Requirement annotations
fsar:appliesToSector a owl:ObjectProperty ;
  rdfs:domain fsar:Requirement ;
  rdfs:range  skos:Concept ;
  rdfs:label "applies to sector"@en .

fsar:relatesToDecisionType a owl:ObjectProperty ;
  rdfs:domain fsar:Requirement ;
  rdfs:range  skos:Concept ;
  rdfs:label "relates to decision type"@en .

# Status/quality annotations you will attach to dfo:StatusAssessment instances in data (module contributes properties)
fsar:statusZone a owl:ObjectProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  skos:Concept ;
  rdfs:label "status zone (WSP)"@en ;
  rdfs:comment "Attach one of fsar:WSP_Red | fsar:WSP_Amber | fsar:WSP_Green."@en .

fsar:downgradeReason a owl:ObjectProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  skos:Concept ;
  rdfs:label "downgrade reason"@en .

fsar:mixedStockFishery a owl:DatatypeProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  xsd:boolean ;
  rdfs:label "mixed‑stock fishery present"@en .

fsar:gsiUsed a owl:DatatypeProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  xsd:boolean ;
  rdfs:label "GSI used"@en .

fsar:gsiSampleSize a owl:DatatypeProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  xsd:integer ;
  rdfs:label "GSI sample size"@en .

fsar:gsiAssignmentUncertainty a owl:DatatypeProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  xsd:string ;
  rdfs:label "GSI assignment uncertainty"@en .

fsar:cuInclusionPolicy a owl:DatatypeProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  xsd:string ;
  rdfs:label "CU inclusion policy notes"@en .

fsar:statusCI a owl:DatatypeProperty ;
  rdfs:domain dfo:StatusAssessment ;
  rdfs:range  xsd:string ;
  rdfs:label "Status confidence interval"@en .

#################################################################
# Canonical trigger→requirement matrix
#################################################################

# Below LRP => Rebuilding plan under Fisheries Act FSP
fsar:BelowLRPTrigger fsar:triggersRequirement fsar:RebuildingPlanRequirement .
fsar:RebuildingPlanRequirement fsar:requiredBy fsar:FisheriesActFSP .

# Between LRP and USR => Precautionary closure/limit review (WSP/PA)
fsar:BetweenLRPUSRTrigger fsar:triggersRequirement fsar:PrecautionaryClosureReview .
fsar:PrecautionaryClosureReview fsar:requiredBy fsar:WildSalmonPolicy , fsar:PrecautionaryApproach .

# Mixed‑stock without GSI => GSI justification
fsar:MixedStockNoGSITrigger fsar:triggersRequirement fsar:GSIJustificationRequirement .
fsar:GSIJustificationRequirement fsar:requiredBy fsar:PrecautionaryApproach .

# CU proxied/excluded => CU accounting justification
fsar:CUProxiedTrigger fsar:triggersRequirement fsar:CUAccountingJustificationRequirement .
fsar:CUAccountingJustificationRequirement fsar:requiredBy fsar:WildSalmonPolicy .

# Missing CI => Uncertainty disclosure
fsar:UncertaintyMissingCITrigger fsar:triggersRequirement fsar:UncertaintyDisclosureRequirement .
fsar:UncertaintyDisclosureRequirement fsar:requiredBy fsar:PrecautionaryApproach .

#################################################################
# Mapping hints (non‑logical, for UI/SPARQL usage)
#################################################################
# To determine which TriggerCondition applies for a given dfo:StatusAssessment instance,
# apps can use SPARQL patterns such as:
#  - IF fsar:statusZone = fsar:WSP_Red         → treat as fsar:BelowLRPTrigger
#  - IF fsar:statusZone = fsar:WSP_Amber       → treat as fsar:BetweenLRPUSRTrigger
#  - IF fsar:mixedStockFishery = true AND fsar:gsiUsed = false → fsar:MixedStockNoGSITrigger
#  - IF fsar:downgradeReason includes fsar:ProxyCU            → fsar:CUProxiedTrigger
#  - IF fsar:statusCI missing                                  → fsar:UncertaintyMissingCITrigger
#
# The resulting TriggerCondition(s) are then joined to fsar:triggersRequirement to list required checks.
# This meets the requirement to avoid tracking specific decision instances while still guiding decisions.
